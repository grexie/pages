{"version":3,"file":"index.js","names":["useEffect","useMemo","useState","useStyles","useFirstRender","StyleSheet","constructor","hash","css","locals","variables","use","isFirstRender","styles","loading","window","add","_loading","setLoading","hasRendered","resolve","cls","classes","classList","out","Set","k","join","var","name","wrapStyles","bind","styleSheet"],"sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport { useStyles, useFirstRender } from '@grexie/pages';\n\nexport type Class = string | Record<string, any> | null | undefined;\nexport type StyleUnuseFunction = () => void;\nexport type StyleUseFunction = () => boolean;\nexport type StyleFunction = ((...classList: Class[]) => string) & {\n  hash: string;\n  css: string;\n  use: StyleUseFunction;\n  resolve: (cls: string) => string;\n  var: (name: string) => string;\n  styleSheet: StyleSheet;\n};\n\nexport class StyleSheet {\n  readonly hash: string;\n  readonly css: string;\n  readonly locals: Record<string, string>;\n  readonly variables: Record<string, string>;\n\n  constructor(\n    hash: string,\n    css: string,\n    locals: Record<string, string>,\n    variables: Record<string, string>\n  ) {\n    this.hash = hash;\n    this.css = css;\n    this.locals = locals;\n    this.variables = variables;\n  }\n\n  use() {\n    const isFirstRender = useFirstRender();\n    const styles = useStyles();\n\n    let loading;\n\n    if (typeof window === 'undefined') {\n      loading = useMemo(() => {\n        styles.add(this.hash, this.css, () => {});\n        return false;\n      }, []);\n    } else {\n      const [_loading, setLoading] = useState(\n        () => !isFirstRender && !styles.hasRendered(this.hash)\n      );\n      loading = _loading;\n      useEffect(() => {\n        return styles.add(this.hash, this.css, () => {\n          setLoading(() => false);\n        });\n      }, []);\n    }\n\n    return loading;\n  }\n\n  resolve(cls: string) {\n    if (this.locals[cls]) {\n      return this.locals[cls];\n    } else {\n      return cls;\n    }\n  }\n\n  classes(...classList: Class[]) {\n    const out = new Set<string>();\n\n    for (const cls of classList) {\n      if (typeof cls === 'string') {\n        out.add(this.resolve(cls));\n      }\n      if (typeof cls === 'object') {\n        for (const k in cls) {\n          if (!!cls[k]) {\n            out.add(this.resolve(k));\n          }\n        }\n      }\n    }\n\n    return [...out].join(' ');\n  }\n\n  var(name: string) {\n    return this.variables[name];\n  }\n}\n\nexport const wrapStyles = (\n  hash: string,\n  css: string,\n  locals: Record<string, string> = {},\n  variables: Record<string, string> = {}\n) => {\n  const styles = new StyleSheet(hash, css, locals, variables);\n\n  const out = styles.classes.bind(styles) as StyleFunction;\n  out.use = styles.use.bind(styles);\n  out.resolve = styles.resolve.bind(styles);\n  out.var = styles.var.bind(styles);\n  out.styleSheet = styles;\n\n  return out;\n};\n"],"mappings":"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"}