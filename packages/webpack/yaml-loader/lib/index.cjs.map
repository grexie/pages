{"version":3,"file":"index.cjs","names":["YamlLoader","content","inputSourceMap","process","env","PAGES_DEBUG_LOADERS","console","debug","resourcePath","transform","getOptions","callback","async","default","YAML","SourceNode","documents","parseAllDocuments","toString","document","length","chunk","JSON","stringify","map","sourceMap","node","setSourceContent","parse","toStringWithSourceMap","file","err","error"],"sources":["../src/index.ts"],"sourcesContent":["import { LoaderContext } from 'webpack';\n\nexport interface YamlLoaderOptions {\n  transform: (doc: any) => any;\n}\n\nexport default async function YamlLoader(\n  this: LoaderContext<YamlLoaderOptions>,\n  content: Buffer,\n  inputSourceMap: any\n) {\n  if (process.env.PAGES_DEBUG_LOADERS === 'true') {\n    console.debug('yaml-loader', this.resourcePath);\n  }\n\n  const { transform } = this.getOptions();\n\n  const callback = this.async();\n  try {\n    const { default: YAML } = await import('yaml');\n    const { SourceNode } = await import('source-map');\n\n    const documents = YAML.parseAllDocuments(content.toString());\n    const document = documents[documents.length - 1];\n    const chunk = `export default ${JSON.stringify(\n      transform?.(document) ?? document,\n      null,\n      2\n    )};`;\n\n    let map;\n\n    if (this.sourceMap) {\n      const node = new SourceNode(1, 1, this.resourcePath, chunk);\n      node.setSourceContent(this.resourcePath, content.toString());\n      map = JSON.parse(\n        node.toStringWithSourceMap({ file: this.resourcePath }).map.toString()\n      );\n    }\n\n    callback(null, chunk, map ?? inputSourceMap);\n  } catch (err: any) {\n    console.error(err);\n    callback(err);\n  } finally {\n    if (process.env.PAGES_DEBUG_LOADERS === 'true') {\n      console.debug('yaml-loader:complete', this.resourcePath);\n    }\n  }\n}\n"],"mappings":";;;;;;AAMe,eAAeA,UAAUA,CAEtCC,OAAe,EACfC,cAAmB,EACnB;EACA,IAAIC,OAAO,CAACC,GAAG,CAACC,mBAAmB,KAAK,MAAM,EAAE;IAC9CC,OAAO,CAACC,KAAK,CAAC,aAAa,EAAE,IAAI,CAACC,YAAY,CAAC;EACjD;EAEA,MAAM;IAAEC;EAAU,CAAC,GAAG,IAAI,CAACC,UAAU,CAAC,CAAC;EAEvC,MAAMC,QAAQ,GAAG,IAAI,CAACC,KAAK,CAAC,CAAC;EAC7B,IAAI;IACF,MAAM;MAAEC,OAAO,EAAEC;IAAK,CAAC,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC;IAC9C,MAAM;MAAEC;IAAW,CAAC,GAAG,MAAM,MAAM,CAAC,YAAY,CAAC;IAEjD,MAAMC,SAAS,GAAGF,IAAI,CAACG,iBAAiB,CAAChB,OAAO,CAACiB,QAAQ,CAAC,CAAC,CAAC;IAC5D,MAAMC,QAAQ,GAAGH,SAAS,CAACA,SAAS,CAACI,MAAM,GAAG,CAAC,CAAC;IAChD,MAAMC,KAAK,GAAI,kBAAiBC,IAAI,CAACC,SAAS,CAC5Cd,SAAS,GAAGU,QAAQ,CAAC,IAAIA,QAAQ,EACjC,IAAI,EACJ,CACF,CAAE,GAAE;IAEJ,IAAIK,GAAG;IAEP,IAAI,IAAI,CAACC,SAAS,EAAE;MAClB,MAAMC,IAAI,GAAG,IAAIX,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAACP,YAAY,EAAEa,KAAK,CAAC;MAC3DK,IAAI,CAACC,gBAAgB,CAAC,IAAI,CAACnB,YAAY,EAAEP,OAAO,CAACiB,QAAQ,CAAC,CAAC,CAAC;MAC5DM,GAAG,GAAGF,IAAI,CAACM,KAAK,CACdF,IAAI,CAACG,qBAAqB,CAAC;QAAEC,IAAI,EAAE,IAAI,CAACtB;MAAa,CAAC,CAAC,CAACgB,GAAG,CAACN,QAAQ,CAAC,CACvE,CAAC;IACH;IAEAP,QAAQ,CAAC,IAAI,EAAEU,KAAK,EAAEG,GAAG,IAAItB,cAAc,CAAC;EAC9C,CAAC,CAAC,OAAO6B,GAAQ,EAAE;IACjBzB,OAAO,CAAC0B,KAAK,CAACD,GAAG,CAAC;IAClBpB,QAAQ,CAACoB,GAAG,CAAC;EACf,CAAC,SAAS;IACR,IAAI5B,OAAO,CAACC,GAAG,CAACC,mBAAmB,KAAK,MAAM,EAAE;MAC9CC,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAE,IAAI,CAACC,YAAY,CAAC;IAC1D;EACF;AACF"}